{"version":3,"file":"EditTheResource.js","names":["React","Button","Modal","Form","FormGroup","TextInput","InputGroup","ModalVariant","OkIcon","Scope","Msg","AccountServiceContext","ContentAlert","PermissionSelect","EditTheResource","Component","constructor","props","context","_defineProperty","state","isOpen","setState","onClose","clearState","row","changed","savePermission","permission","doPut","encodeURIComponent","resource","_id","success","localize","render","createElement","Fragment","children","handleToggleDialog","title","name","variant","large","actions","key","id","onClick","msgKey","isHorizontal","permissions","map","p","fieldId","label","type","value","username","isDisabled","isRequired","scopes","selected","s","direction","length","onSelect","selection","updateChanged"],"sources":["../../../src/app/content/my-resources-page/EditTheResource.tsx"],"sourcesContent":["/*\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from 'react';\n\nimport {\n    Button,\n    Modal,\n    Form,\n    FormGroup,\n    TextInput,\n    InputGroup,\n    ModalVariant\n} from '@patternfly/react-core';\nimport { OkIcon } from '@patternfly/react-icons';\n\nimport { Resource, Permission, Permissions, Scope } from './resource-model';\nimport { Msg } from '../../widgets/Msg';\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\nimport { ContentAlert } from '../ContentAlert';\nimport { PermissionSelect } from './PermissionSelect';\n\ninterface EditTheResourceProps {\n    resource: Resource;\n    permissions: Permission[];\n    onClose: () => void;\n    children: (toggle: () => void) => void;\n}\n\ninterface EditTheResourceState {\n    changed: boolean[];\n    isOpen: boolean;\n}\n\nexport class EditTheResource extends React.Component<EditTheResourceProps, EditTheResourceState> {\n    protected static defaultProps:Permissions = { permissions: [] };\n    static contextType = AccountServiceContext;\n    context: React.ContextType<typeof AccountServiceContext>;\n\n    public constructor(props: EditTheResourceProps, context: React.ContextType<typeof AccountServiceContext>) {\n        super(props);\n        this.context = context;\n\n        this.state = {\n            changed: [],\n            isOpen: false,\n        };\n    }\n\n    private clearState(): void {\n        this.setState({});\n    }\n\n    private handleToggleDialog = () => {\n        if (this.state.isOpen) {\n            this.setState({ isOpen: false });\n            this.props.onClose();\n        } else {\n            this.clearState();\n            this.setState({ isOpen: true });\n        }\n    };\n\n    private updateChanged = (row: number) => {\n        const changed = this.state.changed;\n        changed[row] = !changed[row];\n        this.setState({ changed });\n    }\n\n    async savePermission(permission: Permission): Promise<void> {\n        await this.context!.doPut(`/resources/${encodeURIComponent(this.props.resource._id)}/permissions`, [permission]);\n        ContentAlert.success(Msg.localize('updateSuccess'));\n    }\n\n    public render(): React.ReactNode {\n        return (\n            <React.Fragment>\n                {this.props.children(this.handleToggleDialog)}\n\n                <Modal\n                    title={'Edit the resource - ' + this.props.resource.name}\n                    variant={ModalVariant.large}\n                    isOpen={this.state.isOpen}\n                    onClose={this.handleToggleDialog}\n                    actions={[\n                        <Button key=\"done\" variant=\"link\" id=\"done\" onClick={this.handleToggleDialog}>\n                            <Msg msgKey='done' />\n                        </Button>,\n                    ]}\n                >\n                    <Form isHorizontal>\n                        {this.props.permissions.map((p, row) => (\n                            <React.Fragment>\n                                <FormGroup\n                                    fieldId={`username-${row}`}\n                                    label={Msg.localize('User')}\n                                >\n                                    <TextInput id={`username-${row}`} type=\"text\" value={p.username} isDisabled />\n\n                                </FormGroup>\n                                <FormGroup\n                                    fieldId={`permissions-${row}`}\n                                    label={Msg.localize('permissions')}\n                                    isRequired\n                                >\n                                    <InputGroup>\n                                        <PermissionSelect\n                                            scopes={this.props.resource.scopes}\n                                            selected={(p.scopes as string[]).map(s => new Scope(s))}\n                                            direction={row === this.props.permissions.length - 1 ? \"up\" : \"down\"}\n                                            onSelect={selection => {\n                                                p.scopes = selection.map(s => s.name);\n                                                this.updateChanged(row);\n                                            }}\n                                        />\n                                        <Button\n                                            id={`save-${row}`}\n                                            isDisabled={!this.state.changed[row]}\n                                            onClick={() => this.savePermission(p)}\n                                        >\n                                            <OkIcon />\n                                        </Button>\n                                    </InputGroup>\n                                </FormGroup>\n                                <hr />\n                            </React.Fragment>\n                        ))}\n                    </Form>\n                </Modal>\n            </React.Fragment>\n        );\n    }\n}\n"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,KAAKA,KAAK;AAEjB,SACIC,MAAM,EACNC,KAAK,EACLC,IAAI,EACJC,SAAS,EACTC,SAAS,EACTC,UAAU,EACVC,YAAY;AAEhB,SAASC,MAAM;AAEf,SAA4CC,KAAK;AACjD,SAASC,GAAG;AACZ,SAASC,qBAAqB;AAC9B,SAASC,YAAY;AACrB,SAASC,gBAAgB;AAczB,OAAO,MAAMC,eAAe,SAASd,KAAK,CAACe,SAAS,CAA6C;EAKtFC,WAAWA,CAACC,KAA2B,EAAEC,OAAwD,EAAE;IACtG,KAAK,CAACD,KAAK,CAAC;IAACE,eAAA;IAAAA,eAAA,6BAaY,MAAM;MAC/B,IAAI,IAAI,CAACC,KAAK,CAACC,MAAM,EAAE;QACnB,IAAI,CAACC,QAAQ,CAAC;UAAED,MAAM,EAAE;QAAM,CAAC,CAAC;QAChC,IAAI,CAACJ,KAAK,CAACM,OAAO,CAAC,CAAC;MACxB,CAAC,MAAM;QACH,IAAI,CAACC,UAAU,CAAC,CAAC;QACjB,IAAI,CAACF,QAAQ,CAAC;UAAED,MAAM,EAAE;QAAK,CAAC,CAAC;MACnC;IACJ,CAAC;IAAAF,eAAA,wBAEwBM,GAAW,IAAK;MACrC,MAAMC,OAAO,GAAG,IAAI,CAACN,KAAK,CAACM,OAAO;MAClCA,OAAO,CAACD,GAAG,CAAC,GAAG,CAACC,OAAO,CAACD,GAAG,CAAC;MAC5B,IAAI,CAACH,QAAQ,CAAC;QAAEI;MAAQ,CAAC,CAAC;IAC9B,CAAC;IA1BG,IAAI,CAACR,OAAO,GAAGA,OAAO;IAEtB,IAAI,CAACE,KAAK,GAAG;MACTM,OAAO,EAAE,EAAE;MACXL,MAAM,EAAE;IACZ,CAAC;EACL;EAEQG,UAAUA,CAAA,EAAS;IACvB,IAAI,CAACF,QAAQ,CAAC,CAAC,CAAC,CAAC;EACrB;EAkBA,MAAMK,cAAcA,CAACC,UAAsB,EAAiB;IACxD,MAAM,IAAI,CAACV,OAAO,CAAEW,KAAK,CAAE,cAAaC,kBAAkB,CAAC,IAAI,CAACb,KAAK,CAACc,QAAQ,CAACC,GAAG,CAAE,cAAa,EAAE,CAACJ,UAAU,CAAC,CAAC;IAChHhB,YAAY,CAACqB,OAAO,CAACvB,GAAG,CAACwB,QAAQ,CAAC,eAAe,CAAC,CAAC;EACvD;EAEOC,MAAMA,CAAA,EAAoB;IAC7B,oBACInC,KAAA,CAAAoC,aAAA,CAACpC,KAAK,CAACqC,QAAQ,QACV,IAAI,CAACpB,KAAK,CAACqB,QAAQ,CAAC,IAAI,CAACC,kBAAkB,CAAC,eAE7CvC,KAAA,CAAAoC,aAAA,CAAClC,KAAK;MACFsC,KAAK,EAAE,sBAAsB,GAAG,IAAI,CAACvB,KAAK,CAACc,QAAQ,CAACU,IAAK;MACzDC,OAAO,EAAEnC,YAAY,CAACoC,KAAM;MAC5BtB,MAAM,EAAE,IAAI,CAACD,KAAK,CAACC,MAAO;MAC1BE,OAAO,EAAE,IAAI,CAACgB,kBAAmB;MACjCK,OAAO,EAAE,cACL5C,KAAA,CAAAoC,aAAA,CAACnC,MAAM;QAAC4C,GAAG,EAAC,MAAM;QAACH,OAAO,EAAC,MAAM;QAACI,EAAE,EAAC,MAAM;QAACC,OAAO,EAAE,IAAI,CAACR;MAAmB,gBACzEvC,KAAA,CAAAoC,aAAA,CAAC1B,GAAG;QAACsC,MAAM,EAAC;MAAM,CAAE,CAChB,CAAC;IACX,gBAEFhD,KAAA,CAAAoC,aAAA,CAACjC,IAAI;MAAC8C,YAAY;IAAA,GACb,IAAI,CAAChC,KAAK,CAACiC,WAAW,CAACC,GAAG,CAAC,CAACC,CAAC,EAAE3B,GAAG,kBAC/BzB,KAAA,CAAAoC,aAAA,CAACpC,KAAK,CAACqC,QAAQ,qBACXrC,KAAA,CAAAoC,aAAA,CAAChC,SAAS;MACNiD,OAAO,EAAG,YAAW5B,GAAI,EAAE;MAC3B6B,KAAK,EAAE5C,GAAG,CAACwB,QAAQ,CAAC,MAAM;IAAE,gBAE5BlC,KAAA,CAAAoC,aAAA,CAAC/B,SAAS;MAACyC,EAAE,EAAG,YAAWrB,GAAI,EAAE;MAAC8B,IAAI,EAAC,MAAM;MAACC,KAAK,EAAEJ,CAAC,CAACK,QAAS;MAACC,UAAU;IAAA,CAAE,CAEtE,CAAC,eACZ1D,KAAA,CAAAoC,aAAA,CAAChC,SAAS;MACNiD,OAAO,EAAG,eAAc5B,GAAI,EAAE;MAC9B6B,KAAK,EAAE5C,GAAG,CAACwB,QAAQ,CAAC,aAAa,CAAE;MACnCyB,UAAU;IAAA,gBAEV3D,KAAA,CAAAoC,aAAA,CAAC9B,UAAU,qBACPN,KAAA,CAAAoC,aAAA,CAACvB,gBAAgB;MACb+C,MAAM,EAAE,IAAI,CAAC3C,KAAK,CAACc,QAAQ,CAAC6B,MAAO;MACnCC,QAAQ,EAAGT,CAAC,CAACQ,MAAM,CAAcT,GAAG,CAACW,CAAC,IAAI,IAAIrD,KAAK,CAACqD,CAAC,CAAC,CAAE;MACxDC,SAAS,EAAEtC,GAAG,KAAK,IAAI,CAACR,KAAK,CAACiC,WAAW,CAACc,MAAM,GAAG,CAAC,GAAG,IAAI,GAAG,MAAO;MACrEC,QAAQ,EAAEC,SAAS,IAAI;QACnBd,CAAC,CAACQ,MAAM,GAAGM,SAAS,CAACf,GAAG,CAACW,CAAC,IAAIA,CAAC,CAACrB,IAAI,CAAC;QACrC,IAAI,CAAC0B,aAAa,CAAC1C,GAAG,CAAC;MAC3B;IAAE,CACL,CAAC,eACFzB,KAAA,CAAAoC,aAAA,CAACnC,MAAM;MACH6C,EAAE,EAAG,QAAOrB,GAAI,EAAE;MAClBiC,UAAU,EAAE,CAAC,IAAI,CAACtC,KAAK,CAACM,OAAO,CAACD,GAAG,CAAE;MACrCsB,OAAO,EAAEA,CAAA,KAAM,IAAI,CAACpB,cAAc,CAACyB,CAAC;IAAE,gBAEtCpD,KAAA,CAAAoC,aAAA,CAAC5B,MAAM,MAAE,CACL,CACA,CACL,CAAC,eACZR,KAAA,CAAAoC,aAAA,WAAK,CACO,CACnB,CACC,CACH,CACK,CAAC;EAEzB;AACJ;AAACjB,eAAA,CAlGYL,eAAe,kBACoB;EAAEoC,WAAW,EAAE;AAAG,CAAC;AAAA/B,eAAA,CADtDL,eAAe,iBAEHH,qBAAqB"}