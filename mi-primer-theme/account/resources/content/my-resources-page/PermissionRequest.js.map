{"version":3,"file":"PermissionRequest.js","names":["React","Button","Modal","Text","Badge","DataListItem","DataList","TextVariants","DataListItemRow","DataListItemCells","DataListCell","Chip","Split","SplitItem","ModalVariant","UserCheckIcon","AccountServiceContext","Msg","ContentAlert","PermissionRequest","Component","constructor","props","context","_defineProperty","shareRequest","index","handle","username","scopes","resource","shareRequests","splice","approve","id","_id","handleToggleDialog","permissionsRequest","doGet","encodeURIComponent","permissions","data","foundPermission","find","p","userScopes","push","doPut","success","localize","onClose","e","console","error","setState","isOpen","state","render","name","replace","createElement","Fragment","variant","onClick","size","length","title","large","actions","key","msgKey","dataListCells","width","map","i","firstName","lastName","component","small","email","scope","j","isReadOnly","hasGutter","handleApprove","handleDeny","row"],"sources":["../../../src/app/content/my-resources-page/PermissionRequest.tsx"],"sourcesContent":["/*\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as React from 'react';\nimport {\n    Button,\n    Modal,\n    Text,\n    Badge,\n    DataListItem,\n    DataList,\n    TextVariants,\n    DataListItemRow,\n    DataListItemCells,\n    DataListCell,\n    Chip,\n    Split,\n    SplitItem,\n    ModalVariant\n} from '@patternfly/react-core';\nimport { UserCheckIcon } from '@patternfly/react-icons';\n\nimport { HttpResponse } from '../../account-service/account.service';\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\nimport { Msg } from '../../widgets/Msg';\nimport { ContentAlert } from '../ContentAlert';\nimport { Resource, Scope, Permission, Permissions } from './resource-model';\n\n\ninterface PermissionRequestProps {\n    resource: Resource;\n    onClose: () => void;\n}\n\ninterface PermissionRequestState {\n    isOpen: boolean;\n}\n\nexport class PermissionRequest extends React.Component<PermissionRequestProps, PermissionRequestState> {\n    protected static defaultProps:Permissions = { permissions: [], row: 0 };\n    static contextType = AccountServiceContext;\n    context: React.ContextType<typeof AccountServiceContext>;\n\n    public constructor(props: PermissionRequestProps, context: React.ContextType<typeof AccountServiceContext>) {\n        super(props);\n        this.context = context;\n    \n        this.state = {\n            isOpen: false,\n        };\n    }\n\n    private handleApprove = async (shareRequest: Permission, index: number) => {\n        this.handle(shareRequest.username, shareRequest.scopes as Scope[], true);\n        this.props.resource.shareRequests.splice(index, 1);\n    };\n\n    private handleDeny = async (shareRequest: Permission, index: number) => {\n        this.handle(shareRequest.username, shareRequest.scopes as Scope[]);\n        this.props.resource.shareRequests.splice(index, 1)\n    };\n\n    private handle = async (username: string, scopes: Scope[], approve: boolean = false) => {\n        const id = this.props.resource._id\n        this.handleToggleDialog();\n\n        const permissionsRequest: HttpResponse<Permission[]> = await this.context!.doGet(`/resources/${encodeURIComponent(id)}/permissions`);\n        const permissions = permissionsRequest.data || [];\n        const foundPermission = permissions.find(p => p.username === username);\n        const userScopes = foundPermission ? (foundPermission.scopes as Scope[]): [];\n        if (approve) {\n            userScopes.push(...scopes);\n        }\n        try {\n            await this.context!.doPut(`/resources/${encodeURIComponent(id)}/permissions`, [{ username: username, scopes: userScopes }] )\n            ContentAlert.success(Msg.localize('shareSuccess'));\n            this.props.onClose();\n        } catch (e) {\n            console.error('Could not update permissions', (e as any).error);\n        }\n    };\n\n    private handleToggleDialog = () => {\n        this.setState({ isOpen: !this.state.isOpen });\n    };\n\n    public render(): React.ReactNode {\n        const id = `shareRequest-${this.props.resource.name.replace(/\\s/, '-')}`;\n        return (\n            <React.Fragment>\n                <Button id={id} variant=\"link\" onClick={this.handleToggleDialog}>\n                    <UserCheckIcon size=\"lg\" />\n                    <Badge>{this.props.resource.shareRequests.length}</Badge>\n                </Button>\n\n                <Modal\n                    id={`modal-${id}`}\n                    title={Msg.localize('permissionRequests') + ' - ' + this.props.resource.name}\n                    variant={ModalVariant.large}\n                    isOpen={this.state.isOpen}\n                    onClose={this.handleToggleDialog}\n                    actions={[\n                        <Button id={`close-${id}`} key=\"close\" variant=\"link\" onClick={this.handleToggleDialog}>\n                            <Msg msgKey=\"close\" />\n                        </Button>,\n                    ]}\n                >\n                    <DataList aria-label={Msg.localize('permissionRequests')}>\n                        <DataListItemRow>\n                            <DataListItemCells\n                                dataListCells={[\n                                    <DataListCell key='permissions-name-header' width={5}>\n                                        <strong>Requestor</strong>\n                                    </DataListCell>,\n                                    <DataListCell key='permissions-requested-header' width={5}>\n                                        <strong><Msg msgKey='permissionRequests' /></strong>\n                                    </DataListCell>,\n                                    <DataListCell key='permission-request-header' width={5}>\n                                    </DataListCell>\n                                ]}\n                            />\n                        </DataListItemRow>\n                        {this.props.resource.shareRequests.map((shareRequest, i) =>\n                            <DataListItem key={i} aria-labelledby=\"requestor\">\n                                <DataListItemRow>\n                                    <DataListItemCells\n                                        dataListCells={[\n                                            <DataListCell id={`requestor${i}`} key={`requestor${i}`}>\n                                                <span>\n                                                    {shareRequest.firstName} {shareRequest.lastName} {shareRequest.lastName ? '' : shareRequest.username}\n                                                </span><br />\n                                                <Text component={TextVariants.small}>{shareRequest.email}</Text>\n                                            </DataListCell>,\n                                            <DataListCell id={`permissions${i}`} key={`permissions${i}`}>\n                                                {(shareRequest.scopes as Scope[]).map((scope, j) => <Chip key={j} isReadOnly>{scope}</Chip>)}\n                                            </DataListCell>,\n                                            <DataListCell key={`actions${i}`}>\n                                                <Split hasGutter>\n                                                    <SplitItem>\n                                                        <Button\n                                                            id={`accept-${i}-${id}`}\n                                                            onClick={() => this.handleApprove(shareRequest, i)}\n                                                        >\n                                                            Accept\n                                                        </Button>\n                                                    </SplitItem>\n                                                    <SplitItem>\n                                                        <Button\n                                                            id={`deny-${i}-${id}`}\n                                                            variant=\"danger\"\n                                                            onClick={() => this.handleDeny(shareRequest, i)}\n                                                        >\n                                                            Deny\n                                                        </Button>\n                                                    </SplitItem>\n                                                </Split>\n                                            </DataListCell>\n                                        ]}\n                                    />\n                                </DataListItemRow>\n                            </DataListItem>\n                        )}\n                    </DataList>\n                </Modal>\n            </React.Fragment>\n        );\n    }\n}\n"],"mappings":"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"}